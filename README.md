# cve-2022-44268-detector - detect malicious PNGs

cve-2022-44268-detector is a Go program that consumes PNGs and reports whether they appear to be malicious images generated by an exploit for [CVE-2022-44268][cve-2022-44268], an ImageMagick vulnerability that allows attackers to read arbitrary file contents using specially crafted images.

[cve-2022-44268]: https://www.metabaseq.com/imagemagick-zero-days/

## Installation

To install cve-2022-44268-detector, use `go install`:

```
$ go install github.com/jnschaeffer/cve-2022-44268-detector@latest
```

## Warning

*Please be very careful* when working with untrusted data. An attacker can
craft a png chunk that may contain non-zlib data (such as a shell script,
or code that exploits a bug in your detection workflow). Accidentally
writing attacker-supplied code to a terminal or to a shell can result in
execution of malicious code. It is strongly recommended that the detector
be executed in a virtual machine or isolated compute environment to help
mitigate such security failures.

## Usage

cve-2022-44268-detector is a command line application. You can run it as follows:

```
$ cve-2022-44268-detector -filename image.png
***PROFILE CHUNK FOUND! if this was found in a production system, update your dependencies immediately and inspect your systems for evidence of further compromise!***
```

Users may optionally output the contents of the exfiltrated chunk to stdout
by supplying the `-print` argument. *Please note* that the chunk's value is
likely binary, zlib-compressed data (i.e., not human-readable). Users are
strongly advised to redirect this data to a file.

```
$ cve-2022-44268-detector -filename image.png -print > /tmp/out
***PROFILE CHUNK FOUND! if this was found in a production system, update your dependencies immediately and inspect your systems for evidence of further compromise!***
$ hexdump -C /tmp/out
```

zlib-compressed data can be decompressed from a shell by executing:

```
# Note: wkpark's idea - https://unix.stackexchange.com/a/49066
$ printf "\x1f\x8b\x08\x00\x00\x00\x00\x00" | cat - /tmp/out | gzip -dc | hexdump -C
```

## Exit status

The program will exit with status 0 if a chunk with keyword `Raw profile type` was found.
